<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Python and Django and testing - oh my!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Luke writes about coding (mostly)</title>
<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="assets/css/code.css" rel="stylesheet" type="text/css">
<link href="assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://lukewrites.github.io/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/switching-aws-elastic-beanstalk-site-https/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://lukewrites.github.io/">

                <span id="blog-title">Luke writes about coding (mostly)</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/switching-aws-elastic-beanstalk-site-https/" class="u-url">Switching your AWS Elastic Beanstalk site to https</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/switching-aws-elastic-beanstalk-site-https/" rel="bookmark"><time class="published dt-published" datetime="2017-08-29T12:36:24-07:00" title="2017-08-29 12:36">2017-08-29 12:36</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<h3>Why does <code>https</code> matter?</h3>
<p>If you have a website that involves any personal information (including passwords), you should be securing your site with https. Even if you're not interested in your users' data, there are pragmatic reasons to use http; Google's going to start labeling non-https domains as "unsecured". So, avoid that label and use https!</p>
<p><a href="https://letsencrypt.org/">Let's Encrypt!</a> was one of the first to offer free SSL certificates to anyone; if you host on Amazon Web Services via Elastic Beanstalk you can't easily install one of their certificates, but you still can install a free certificate.</p>
<p>Below I'll show you how to: get a free SSL certificate from <a href="https://aws.amazon.com/certificate-manager/">AWS Certificate Manager</a>, connect that certificate to your site hosted on <a href="https://aws.amazon.com/elasticbeanstalk/">AWS Elastic Beanstalk</a>, and automatically route regular, unsecured <code>http</code> traffic to your new <code>https</code> address(es).</p>
<p>The steps we will go through are as follows:
1. Get an SSL certificate for your site
2. Modify one of the <code>.config</code> files in your <code>.ebextensions</code> folder
3. Update your settings to switch to https
4. Push your changes to master</p>
<h4>1. Get an SSL certificate for your site</h4>
<p><a href="https://aws.amazon.com/certificate-manager/">AWS Certificate Manager</a> issues free certificates, and is straightforward to use. You (a) specify what domain (<em>and subdomains</em>) you want a certificate for, (b) submit your request, and then (c) click through a confirmation link that will be emailed to you.</p>
<p><strong>IMPORTANT</strong> Keep in mind that <code>*.blah.com</code> will resolve to <code>https://blog.blah.com</code> and <code>https://www.blah.com</code>, but not <code>https://blah.com</code>, so after entering your domain name, be sure to click on "Add another name to this certificate" and include your plain domain name (e.g. <code>blah.com</code>)</p>
<p><img alt="request your ssl cert" src="images/request_ssl_cert.png"></p>
<p>After clicking on <em>Review and Request</em> you will come to another page where you review the domain name for which you've requested a certificate and submit your request. AWS sends an email to the admin email address for your domain. The message contains a link that lets you verify that you do indeed want the certificate issued. Once you've verified it, it's time to make changes to some code.</p>
<h4>2. Update one of your <code>.config</code> files to redirect all traffic to SSL</h4>
<p>Elastic Beanstalk deployments are customized by <code>.config</code> files in the <code>.ebextensions</code> folder in your project's root directory. To deploy my site I followed <a href="https://realpython.com/blog/python/deploying-a-django-app-and-postgresql-to-aws-elastic-beanstalk/">RealPython's excellent guide to deployment on Elastic Beanstalk</a>, which left me with two files in my <code>.ebextensions</code> folder: <code>01_packages.config</code> and <code>02_python.config</code>. Without making changes to your <code>.config</code>, your site will not redirect <code>http</code> connections to <code>https</code>; instead, it will allow both types. Thanks to <a href="https://stackoverflow.com/questions/14693852/how-to-force-https-on-elastic-beanstalk/38751749#38751749">this StackOverflow post</a>, we can copy and paste code into one of these <code>.config</code> files to redirect <code>http</code> traffic to <code>https</code>.</p>
<p>My original <code>01_packages.config</code> looked like this:</p>
<pre class="code literal-block"><span class="n">packages</span><span class="o">:</span>
  <span class="n">yum</span><span class="o">:</span>
    <span class="n">git</span><span class="o">:</span> <span class="o">[]</span>
    <span class="n">postgresql93</span><span class="o">-</span><span class="n">devel</span><span class="o">:</span> <span class="o">[]</span>
    <span class="n">libjpeg</span><span class="o">-</span><span class="n">turbo</span><span class="o">-</span><span class="n">devel</span><span class="o">:</span> <span class="o">[]</span>
</pre>


<p>I edited <code>01_packages.config</code> to look like this:</p>
<pre class="code literal-block"><span class="nx">packages</span><span class="p">:</span>
  <span class="nx">yum</span><span class="p">:</span>
    <span class="nx">git</span><span class="p">:</span> <span class="err">[</span><span class="cp">]</span>
    postgresql93-devel: <span class="cp">[]</span>
    libjpeg-turbo-devel: <span class="cp">[]</span>

files:
    "/etc/httpd/conf.d/ssl_rewrite.conf":
        mode: "000644"
        owner: root
        group: root
        content: |
            RewriteEngine On
            <span class="nt">&lt;If</span> <span class="err">"-n</span> <span class="err">'%{HTTP:X-Forwarded-Proto}'</span> <span class="err">&amp;&amp;</span> <span class="err">%{HTTP:X-Forwarded-Proto}</span> <span class="err">!=</span> <span class="err">'https'"</span><span class="nt">&gt;</span>
            RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} <span class="cp">[</span><span class="nb">R</span><span class="p">,</span><span class="nx">L</span><span class="cp">]</span>
            <span class="nt">&lt;/If&gt;</span>
</pre>


<p>Now commit your changes, but don't <code>eb deploy</code> just yet...you haven't configured your load balancer to accept <code>https</code> traffic!</p>
<h4>3. Update your settings</h4>
<p>Now we need to turn on <code>https</code> listening. If we don't do this, your site won't know that it should be looking for traffic to SSL endpoints.</p>
<p>In your Elastic Beanstalk application's AWS console, open the <strong>Confirguration</strong> window, scroll down to <em>Network Tier</em>, and open the <em>Load Balancing</em> settings. You'll see something like this:</p>
<p>!(Elastic Beanstalk settings default)[/images/all_off.png]</p>
<p>Under the <strong>Load Balancer</strong> section, change the <em>Secure Listener Port</em> from <code>Off</code> to <code>443</code>, and select your <em>SSL Certificate ID</em>. It should look like this:</p>
<p>!(Elastic Beanstalk settings changed)[/images/all_on.png]</p>
<p>It's important that you leave the regular <em>Listener Port</em> on. If you turn in off, users <strong>must</strong> type in <code>https://</code> before your URL to get to your site. So, don't touch those options.</p>
<h4>4. Deploy your updated code &amp; bask in your secured connection</h4>
<p>Now, hop over to your terminal window and with a quick <code>eb deploy</code> you will push your changes.</p>
<h4>Enjoy</h4>
<p>That's it. You've now got a site that's <code>https</code> by default and didn't cost you a penny more. Got suggestions on how to improve this process? Hit me up <a href="https://twitter.com/lukewrites/">on twitter</a>.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/aws-lambda-typeerror-x-takes-no-arguments-2-given/" class="u-url">AWS Lambda TypeError - "x() takes no arguments (2 given)"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/aws-lambda-typeerror-x-takes-no-arguments-2-given/" rel="bookmark"><time class="published dt-published" datetime="2017-05-22T06:31:05-07:00" title="2017-05-22 06:31">2017-05-22 06:31</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I guess I didn't read the documentation thoroughly enough.</p>
<p>I had some wonderful code that worked on my local machine but constantly threw the following error on AWS Lambda:</p>
<pre class="code literal-block"><span class="p">{</span>
  <span class="nt">"stackTrace"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s2">"/var/runtime/awslambda/bootstrap.py"</span><span class="p">,</span>
      <span class="mi">246</span><span class="p">,</span>
      <span class="s2">"handle_event_request"</span><span class="p">,</span>
      <span class="s2">"result = request_handler(json_input, context)"</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="nt">"errorType"</span><span class="p">:</span> <span class="s2">"TypeError"</span><span class="p">,</span>
  <span class="nt">"errorMessage"</span><span class="p">:</span> <span class="s2">"tweeter() takes no arguments (2 given)"</span>
<span class="p">}</span>
</pre>


<p>What could it mean?</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/finding-a-majority-element-in-python-3/" class="u-url">Finding a Majority Element in Python 3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/finding-a-majority-element-in-python-3/" rel="bookmark"><time class="published dt-published" datetime="2016-10-24T23:05:17-07:00" title="2016-10-24 23:05">2016-10-24 23:05</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Doing more data structure work; asked to find if an array of numbers has a <em>majority element</em> – that is, an element that appears more than 50% of the time in the array.</p>
<p>My assignment is to write a greedy algorithm to do this…but wouldn't it be easier to just use the <code>collections</code> module?</p>
<pre class="code literal-block"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="k">def</span> <span class="nf">majority_element_finder</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</pre>


<p>The <code>most_common([n])</code> returns a list of tuples of the elements in <code>numbers</code> along with the number of times each appears. This is listed in decreasing order. We want to take the first element's (<code>[0]</code>) count ('[1]'), and see if it's greater than half the length of the list.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/thoughts-after-my-first-codjo/" class="u-url">Thoughts after my first codjo</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/thoughts-after-my-first-codjo/" rel="bookmark"><time class="published dt-published" datetime="2016-08-08T10:00:41-07:00" title="2016-08-08 10:00">2016-08-08 10:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>As part of <a href="https://www.recurse.com/blog/99-free-one-on-one-mentorship-for-new-programmers">RC Start</a>, the Recurse Center's mentoring program for new(-ish) programmers, I've started taking part in their "codjo" pair programming challenges. The way it works is that you are given a partner and a puzzle to work on.</p>
<p>A few thoughts about it:</p>
<h3>Technology gets in the way</h3>
<p>Biggest hurdle in getting it done? Figuring out our technology stack for screen sharing. ScreenHero wouldn't let my partner register, even though she had a valid invite. Then it took a while to get Google Hangouts audio working. We spent way too much time getting technology to work…but that seems to be quite a bit of doing development, too.</p>
<h3>Remote pair programming forces you to think clearly</h3>
<p>We used a driver/navigator system. My partner navigated (said what to do) and I drove (typed the code).</p>
<p>It was important to choose good variable names and  write code that we both could understand. Talking things out and getting and giving immediate feedback on how code read felt transformative, in a way. In the past I'd been fearful of going over my code with people (I'd had some bad experiences), but getting to do it in a collaborative, non-judgmental setting was fantastic.</p>
<h3>It's great to have all your tools together</h3>
<p><img alt="My dev environment - Atom, terminal-plus, Neon Color Scheme" src="images/my_atom_environment.png"></p>
<p>While working on the puzzle I was using Atom along with the <a href="https://github.com/jeremyramin/terminal-plus"><code>terminal-plus</code></a> plugin. This meant my partner and I could run tests and try out code snippets in IPython without having to leave the environment. Super useful. Of course, it also could be super embarrassing, like when I realized my machine's name was out there for the world to see. (It's from <a href="https://encrypted.google.com/search?hl=en&amp;q=the%20onion%20curse%20you%20el%20macho#hl=en&amp;q=site:theonion.com+%22curse+you%2C+el+macho!%22">The Onion</a>)</p>
<h3>Group code reviews are scary but fun</h3>
<p>After we finished and submitted our solution there was a group code review. Three groups shared and explained their code. Seeing how other people approached the problem was very helpful – something I love about coding is that you're always able to learn from the code you read. Having the authors explain their thinking and then getting a review of the code from an experienced developer made it even easier to learn.</p>
<h3>In summation</h3>
<p>Do pair programming. It's worth it.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/rounding-decimals-in-python-or-why-doesnt-5-round-to-1/" class="u-url">Rounding decimals in Python (or: Why doesn't .5 round to 1?)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/rounding-decimals-in-python-or-why-doesnt-5-round-to-1/" rel="bookmark"><time class="published dt-published" datetime="2016-07-28T11:37:30-07:00" title="2016-07-28 11:37">2016-07-28 11:37</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Doing my morning Hacker Rank puzzle this morning, I discovered Python 3 doesn't round numbers ending in .5 the way I'd expect:</p>
<pre class="code literal-block"><span class="nb">int</span><span class="p">(</span><span class="mf">12.5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span>
<span class="nb">int</span><span class="p">(</span><span class="mf">13.5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">14</span>
<span class="nb">round</span><span class="p">(</span><span class="mf">12.5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span>
<span class="nb">round</span><span class="p">(</span><span class="mf">13.5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">14</span>
</pre>


<p><banging head against the wall gif goes here></banging></p>
<p>As always, <a href="http://stackoverflow.com/a/10093820/3389827">Stack Overflow had the answer</a>: Python rounds .5 down <em>sometimes</em> because of <a href="https://en.wikipedia.org/wiki/Rounding#Round_half_to_even">Banker's Rounding</a>, also known by the much more informative name "Round Half To Even". Python will round <code>.5</code> numbers to the nearest even whole.</p>
<p>In the problem I was solving (giving a rounded total cost of a meal), this didn't work, so I had to use <code>decimal.Decimal</code>'s <code>quantize</code> method to round up:</p>
<pre class="code literal-block"><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="n">mc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>  <span class="c"># these unpythonic variable names came from HackerRank</span>
<span class="n">tp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
<span class="n">tax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">totalCost</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tax</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">mc</span> <span class="o">+</span> <span class="p">(</span><span class="n">tp</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">mc</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="n">tax</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">mc</span><span class="p">))))</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s">'1'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"The total meal cost is {} dollars."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total</span><span class="p">))</span>

<span class="n">totalCost</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">tax</span><span class="p">)</span>
</pre>


<p>I'm over 80 characters in that line, so there's the potential for refactoring.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/the-difference-between-listsort-and-sortedlist-in-python-3/" class="u-url">The difference between list.sort and sorted(list) in Python 3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/the-difference-between-listsort-and-sortedlist-in-python-3/" rel="bookmark"><time class="published dt-published" datetime="2016-07-20T21:08:50-07:00" title="2016-07-20 21:08">2016-07-20 21:08</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>The other week for my <a href="http://coursera.org/learn/algorithmic-toolbox/">algorithms class</a> I needed to find the minimum dot product of a list. My first try at a solution, which threw an error, was this:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">min_dot_product</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span>
</pre>


<p>Python has two different ways of sorting a list: <code>list.sort([reverse=False])</code> and <code>sorted(list[, reverse=False])</code>. Why a method and a function to do the same thing? Let's look:</p>
<pre class="code literal-block"><span class="n">li</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">li</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">li</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">li</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">li</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre>


<p><code>list.sort()</code> sorts the list and <strong>returns None</strong>.</p>
<p>On the other hand, <code>sorted(list)</code> sorts and <strong>returns the list</strong></p>
<pre class="code literal-block"><span class="n">li</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">li</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre>


<p>I've contributed the above to <a href="http://stackoverflow.com/documentation/python/209/list/2035/list-methods-and-supported-operators#t=201607281859094153184">SO's Python documentation on lists and list methods</a>.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/fun-with-python-3s-print-function/" class="u-url">Fun with Python 3's print function</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/fun-with-python-3s-print-function/" rel="bookmark"><time class="published dt-published" datetime="2016-07-20T10:17:23-07:00" title="2016-07-20 10:17">2016-07-20 10:17</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<h2>Fun with the <code>print</code> function</h2>
<p>Most Pythonistas learn early on that the <code>print</code> function can evaluate statements:</p>
<pre class="code literal-block"><span class="k">print</span><span class="p">(</span><span class="mi">2</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="bp">False</span>
<span class="k">print</span><span class="p">(</span><span class="mi">7</span><span class="o">+</span><span class="mi">5</span><span class="o">==</span><span class="mi">12</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="bp">True</span>
</pre>


<p>However, I didn't know that <code>print</code> can return different strings based upon whether or not the following statement is true or false. The format is:</p>
<pre class="code literal-block"><span class="k">print</span><span class="p">([</span><span class="s">'output for False'</span><span class="p">,</span> <span class="s">'output for True'</span><span class="p">][</span><span class="s">'statement_to_evaluate'</span><span class="p">])</span>
</pre>


<p>For example:</p>
<pre class="code literal-block"><span class="k">print</span><span class="p">([</span><span class="s">'no'</span><span class="p">,</span> <span class="s">'yes'</span><span class="p">][</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">no</span>

<span class="k">print</span><span class="p">([</span><span class="s">'Go back to math class'</span><span class="p">,</span> <span class="s">'You know math!'</span><span class="p">][</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">12</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">You</span> <span class="n">know</span> <span class="n">math</span><span class="err">!</span>
</pre>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/greedy-algorithms-making-change/" class="u-url">Greedy Algorithms: Making Change</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/greedy-algorithms-making-change/" rel="bookmark"><time class="published dt-published" datetime="2016-07-17T17:40:32-07:00" title="2016-07-17 17:40">2016-07-17 17:40</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In this week's installment of my Coursera class on Algorithms, we've been introduced to "greedy" algorithms. One of the homework requires us to solve a tried and tested greedy problem: determining the least number of coins needed to change money.</p>
<p>My first answer to this question wasn't actually a greedy algorithm…but it was only one line:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">get_change</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">+</span> <span class="p">((</span><span class="n">num</span> <span class="o">-</span> <span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="mi">5</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">//</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">num</span> <span class="o">-</span> <span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="mi">10</span><span class="p">))</span> <span class="o">//</span> <span class="mi">10</span><span class="p">))</span>
</pre>


<p>Which adds up the constituent ones, fives, and tens of the number. <a href="http://www.pythontutor.com/visualize.html#code=def+get_change(num%29%3A%0A++++return+(num+%25+5+%2B+((num+-+(num+%25+5%29%29+%25+10+//+5%29+%2B+((num+-+(num+%25+10%29%29+//+10%29%29%0A++++%0Aget_change(6%29&amp;mode=display&amp;origin=opt-frontend.js&amp;cumulative=false&amp;heapPrimitives=false&amp;textReferences=false&amp;py=3&amp;rawInputLstJSON=%5B%5D&amp;curInstr=4)">Here's the code on PythonTutor</a>. While this code passed all the tests, it is neither readable nor greedy. So, back to the drawing board.</p>
<p>Next, I wrote a function that took two variables: the amount (<code>num</code>) and number of coins (<code>coins</code>):</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">get_change</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>

    <span class="k">while</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">10</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">get_change</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">5</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">get_change</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coins</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">get_change</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">coins</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coins</span>
</pre>


<p>Ho there, recursion! The program keeps calling itself, stating the amount of money (<code>m</code>) remaining and the number of coins each time. This also wound up being about twice as fast as my first version of the code: in the online grader, the first version of the code took .04 seconds, while the second iteration took just .02 seconds. Pretty good! <a href="http://www.pythontutor.com/visualize.html#code=def+get_change(m%29%3A%0A++++coins+%3D+0%0A%0A++++while+m%3A%0A++++++++if+m+-+10+%3E%3D0%3A%0A++++++++++++m+-%3D+10%0A++++++++++++coins+%2B%3D+1%0A++++++++++++return+get_change(m%29%0A++++++++if+m+-+5+%3E%3D+0%3A%0A++++++++++++m+-%3D+5%0A++++++++++++coins+%2B%3D+1%0A++++++++++++return+get_change(m%29%0A++++++++if+m+-+1+%3E%3D+0%3A%0A++++++++++++m+-%3D+1%0A++++++++++++coins+%2B%3D+1%0A++++++++++++return+get_change(m%29%0A%0A++++return+coins%0A++++%0Aget_change(6%29&amp;mode=display&amp;origin=opt-frontend.js&amp;cumulative=false&amp;heapPrimitives=false&amp;textReferences=false&amp;py=3&amp;rawInputLstJSON=%5B%5D&amp;curInstr=0)">Here's the code on PythonTutor</a>; it takes 26 steps to find how many coins are needed to change six cents.</p>
<p>That's fine, but I wanted to see if I could do it without that second variable. And whaddayaknow, I could.</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">get_change</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>

    <span class="n">coins</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">10</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">5</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">coins</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">coins</span>
</pre>


<p>That just seems much cleaner and more readable, doesn't it? <a href="http://www.pythontutor.com/visualize.html#code=def+get_change(m%29%3A%0A%0A++++coins+%3D+0%0A%0A++++while+m%3A%0A++++++++while+m+-+10+%3E%3D+0%3A%0A++++++++++++m+-%3D+10%0A++++++++++++coins+%2B%3D+1%0A++++++++while+m+-+5+%3E%3D+0%3A%0A++++++++++++m+-%3D+5%0A++++++++++++coins+%2B%3D+1%0A++++++++while+m+-+1+%3E%3D+0%3A%0A++++++++++++m+-%3D+1%0A++++++++++++coins+%2B%3D+1%0A%0A++++return+coins%0A++++%0Aget_change(6%29&amp;mode=display&amp;origin=opt-frontend.js&amp;cumulative=false&amp;heapPrimitives=false&amp;textReferences=false&amp;py=3&amp;rawInputLstJSON=%5B%5D&amp;curInstr=0)">Looking at it on PythonTutor</a>, it only takes 17 steps to solve <code>get_change(6)</code> – much more efficient than my second attempt! In the online grader this third iteration ran slightly more efficiently, using 4 MB less memory than the second iteration taking the same amount of time.</p>
<h4>What I Would Do Next</h4>
<p>Next steps for the above? If I were to come back to this assignment, I'd work to make the code reusable. Right now it is built to work with pennies, nickels, and dimes. It would be an idea to allow the user to enter an amount and a list of coin values that could be used to determine how many coins are needed to make change.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/chained-geography-lookups-in-django-with-django-smart-selects-and-django-cities-light/" class="u-url">Chained geography lookups in Django with django-smart-selects and django-cities-light</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Luke Petschauer
            </span></p>
            <p class="dateline"><a href="posts/chained-geography-lookups-in-django-with-django-smart-selects-and-django-cities-light/" rel="bookmark"><time class="published dt-published" datetime="2016-07-05T17:03:13-07:00" title="2016-07-05 17:03">2016-07-05 17:03</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Over the past months I've been working in my spare time on a Django based website, <a href="http://www.allTEFL.com">allTEFL</a>, a sort of Glassdoor site for TEFL teachers. This was the project that first made me want to learn to program, and it is hugely exciting to see it come to life.</p>
<p>This is the first in a series of posts in which I'll describe how I designed and organized the site, then talk about some of the fun coding challenges I came across as I worked on it.</p>
<p>First we'll walk through some simple user stories, then talk about how use case scenarios affected how I created my models.</p>
<h4>User Stories</h4>
<p>At first, I figured that there would basically be three things that would happen:</p>
<ol>
<li>A <code>Teacher</code> creates an account so she can review a school (<code>school_review</code>) or a recruiter (<code>recruiter_review</code>).</li>
<li>A <code>Teacher</code> adds a <code>school_review</code> to the database. This is publicly viewable as an anonymous post on the <code>School</code>'s page.</li>
<li>Specific data from the <code>school_review</code> (school name, dates of employment) is visible in the <code>Teacher</code>'s  <code>resume_view</code>.</li>
</ol>
<h4>Putting the Parts Together</h4>
<p>Creating a <code>Teacher</code> model was easy; use Django's <code>auth.User</code> model. The <code>School</code> model has proven to be much more interesting.</p>
<h4>The <code>School</code>
</h4>
<p>A <code>Teacher</code> has a one-to-many relationship with <code>School</code>s that she's taught at and reviewed.</p>
<p>First, a complication: there is no complete list of all the English schools or TEFL recruiters in China. Thus, (2) above has a problem: the <code>Teacher</code>'s <code>School</code> may not exist in the database. So let's revise my user stories:</p>
<ol>
<li>A <code>Teacher</code> adds a <code>school_review</code> for a <code>School</code> in the database.</li>
<li>If the <code>School</code> is not in the database already, the <code>Teacher</code> adds it before reviewing it.</li>
</ol>
<p>Cool. But as it turns out, doing this is a bit harder than it seemed at first glance.</p>
<p>Letting a user add <code>School</code>s to the database is problematic because we don't want data to be fragmented. (One teacher might enter <code>Beijing High School</code>, but another teacher from the same school might look for <code>BHS</code> and then create a new instance of the <code>School</code> model.) So it's important to make finding your school's name as streamlined and precise as possible, reducing peoples' temptation to not look and just add a new school.</p>
<p>We could just add schools by name, but this is problematic because <code>School</code>s may well share names. For example, there are a number of chain schools, similar to test prep behemoths Kaplan or Princeton Review in the US. We want to make sure Wall Street English in Wudaokou, Beijing is distinguishable from WSE in Zhongguancun, Beijing. Also, users will doubtless want to look up schools by location So, just having a list of schools organized by name is not an appropriate way to organize the db.</p>
<h3>Chained Selects in Django</h3>
<p>So, how about a <strong>chained lookup</strong> in our form. A chained lookup means finding all Y that belong to X. This will allow us to select schools (and enter them into the database) based on location. The user can select a <code>Province</code>, which brings up a list of all its <code>City</code>. After selecting the <code>City</code>, you can either (a) select your <code>School</code> or (b) <code>add_school</code> to the database if necessary.</p>
<blockquote>
<p>Country -&gt; Province List -&gt; City List -&gt; Schools<br>
e.g.<br><code>China -&gt; Jilin -&gt; Changchun -&gt; Sino-American Denver Foreign Language School</code></p>
</blockquote>
<p>But to do this, I need a list of all the provinces (and their constituent cities) in a given country. That sounds like quite a bit of work to do by hand…so surely someone's automated it, right?</p>
<p>There are two Django packages that can be combined to (a) populate tables with country, province/state, and city data, and (b) make it easy to build geographic chained selections: <a href="https://github.com/yourlabs/django-cities-light">django-cities-light</a> and <a href="https://github.com/digi604/django-smart-selects">django-smart-selects</a>. Below I will show you how to use the two together to create your own forms in Django that automatically whittle down information from the database to</p>
<p>For my use case it's been necessary to make custom models so I can have views for city, region, and city. Because of this, I need to use the abstract models included in <code>cities_light</code>.</p>
<pre class="code literal-block"><span class="c">#models.py</span>

<span class="kn">from</span> <span class="nn">cities_light.abstract_models</span> <span class="kn">import</span> <span class="n">AbstractCountry</span><span class="p">,</span> <span class="n">AbstractRegion</span><span class="p">,</span> <span class="n">AbstractCity</span>
</pre>


<p>These are our necessary imports. First, we are using the generic models from <code>django-cities-light</code>: <code>Country</code>, <code>Region</code>, and <code>City</code>.</p>
<p><strong>IMPORTANT</strong> There is <a href="https://github.com/yourlabs/django-cities-light/issues/89">a known bug in <code>django-cities-light</code>'s abstract models</a> that requires you to declare your models in the same order that you imported the <code>Abstract</code> models.</p>
<pre class="code literal-block"><span class="kn">from</span> <span class="nn">cities_light.abstract_models</span> <span class="kn">import</span> <span class="n">AbstractCountry</span><span class="p">,</span> <span class="n">AbstractRegion</span><span class="p">,</span> <span class="n">AbstractCity</span>
<span class="kn">from</span> <span class="nn">cities_light.receivers</span> <span class="kn">import</span> <span class="n">connect_default_signals</span>


<span class="c">#models.py</span>

<span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">AbstractCountry</span><span class="p">):</span>

    <span class="k">pass</span>
<span class="n">connect_default_signals</span><span class="p">(</span><span class="n">Country</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Region</span><span class="p">(</span><span class="n">AbstractRegion</span><span class="p">):</span>

    <span class="k">pass</span>
<span class="n">connect_default_signals</span><span class="p">(</span><span class="n">Region</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">AbstractCity</span><span class="p">):</span>

    <span class="k">pass</span>
<span class="n">connect_default_signals</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>
</pre>


<p>We need to register our custom models in the site's <code>settings.py</code>:</p>
<pre class="code literal-block"><span class="c"># settings.py</span>

<span class="n">CITIES_LIGHT_TRANSLATION_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'zh'</span><span class="p">,</span> <span class="s">'en'</span><span class="p">]</span> <span class="c"># I want to include both Chinese &amp; English names</span>
<span class="n">CITIES_LIGHT_INCLUDE_COUNTRIES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'CN'</span><span class="p">]</span> <span class="c"># Download geographic information for China.</span>
<span class="n">CITIES_LIGHT_APP_NAME</span> <span class="o">=</span> <span class="s">'app_name'</span> <span class="c"># Let the app know that I have custom models, defined in this app.</span>
</pre>


<p>From the terminal we now need to run <code>./manage.py cities_light</code> to populate the tables. Three tables will be created: <code>country</code>, <code>region</code>, and <code>city</code>. The tables have a bunch of columns in them. The most important are:</p>
<p><code>country</code></p>
<table>
<thead><tr>
<th align="center">id</th>
<th align="center">name_ascii</th>
<th align="center">slug</th>
</tr></thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">China</td>
<td align="center">china</td>
</tr></tbody>
</table>
<p><code>region</code></p>
<table>
<thead><tr>
<th>Header One</th>
<th>Header Two</th>
</tr></thead>
<tbody><tr>
<td>Item One</td>
<td>Item Two</td>
</tr></tbody>
</table>
<table>
<thead><tr>
<th align="center">id</th>
<th align="center">name_ascii</th>
<th align="center">slug</th>
<th align="center">display_name</th>
<th align="center">country_id</th>
</tr></thead>
<tbody><tr>
<td align="center">2</td>
<td align="center">Qinghai</td>
<td align="center">qinghai</td>
<td align="center">Qinghai, China</td>
<td align="center">Foreign Key</td>
</tr></tbody>
</table>
<p>Worth noting that this model has a foreign key, <code>country_id</code>, that associates with a <code>country</code>.</p>
<p><code>city</code></p>
<table>
<thead><tr>
<th align="center">id</th>
<th align="center">name_ascii</th>
<th align="center">slug</th>
<th align="center">display_name</th>
<th align="center">country_id</th>
<th align="center">region_id</th>
</tr></thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Rikaze</td>
<td align="center">rikaze</td>
<td align="center">Rikaze, Tibet Autonomous Region, China</td>
<td align="center">ForeignKey(country_id)</td>
<td align="center">ForeignKey(region_id)</td>
</tr></tbody>
</table>
<p>Two foreign keys here - <code>country_id</code> and <code>region_id</code>.</p>
<p>The tables include multiple versions of the location's name. I've found <code>name_ascii</code> and <code>display_name</code> to be the two most useful. THe latter includes province and country.</p>
<h4>Linking to City/Province/Country views</h4>
<p>Our existing models are nice, but I want to be able to link to views for each of these models. This means writing a <code>get_absolute_url</code> function for them in my models, adding URL patterns to <code>urls.py</code>, and adding views for each.</p>
<pre class="code literal-block">    <span class="c"># models.py</span>
    <span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">AbstractCountry</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'country_school_list'</span><span class="p">,</span>
                           <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'country_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">})</span>

    <span class="n">connect_default_signals</span><span class="p">(</span><span class="n">Country</span><span class="p">)</span>


    <span class="k">class</span> <span class="nc">Region</span><span class="p">(</span><span class="n">AbstractRegion</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'province_school_list'</span><span class="p">,</span>
                           <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'country_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span>
                                   <span class="s">'province_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">})</span>

    <span class="n">connect_default_signals</span><span class="p">(</span><span class="n">Region</span><span class="p">)</span>


    <span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">AbstractCity</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'city_school_list'</span><span class="p">,</span>
                           <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'country_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span>
                                   <span class="s">'province_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span>
                                   <span class="s">'city_slug'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">})</span>

    <span class="n">connect_default_signals</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>


    <span class="c"># urls.py</span>

        <span class="n">url</span><span class="p">(</span><span class="s">r'^schools/(?P&lt;country_slug&gt;[\w-]+)/$'</span><span class="p">,</span>
            <span class="n">CountrySchoolList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s">'country_school_list'</span><span class="p">),</span>
        <span class="n">url</span><span class="p">(</span><span class="s">r'^schools/(?P&lt;country_slug&gt;[\w-]+)/(?P&lt;province_slug&gt;[\w-]+)/$'</span><span class="p">,</span>
            <span class="n">ProvinceSchoolList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s">'province_school_list'</span><span class="p">),</span>
        <span class="n">url</span><span class="p">(</span><span class="s">r'^schools/(?P&lt;country_slug&gt;[\w-]+)/(?P&lt;province_slug&gt;[\w-]+)/(?P&lt;city_slug&gt;[\w-]+)/$'</span><span class="p">,</span>
            <span class="n">CitySchoolList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="s">'city_school_list'</span><span class="p">),</span>


    <span class="c"># views.py</span>

    <span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">,</span> <span class="n">CreateView</span>
    <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">School</span><span class="p">,</span> <span class="n">Country</span><span class="p">,</span> <span class="n">Region</span><span class="p">,</span> <span class="n">City</span>


    <span class="k">class</span> <span class="nc">CountrySchoolList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">School</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s">"school_reviews/school_list.html"</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'school_province'</span><span class="p">,</span> <span class="s">'school_city'</span><span class="p">,</span> <span class="s">'school_name'</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'country_slug'</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">School</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">school_country</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CountrySchoolList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">context</span><span class="p">[</span><span class="s">'section'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'country'</span>
            <span class="k">return</span> <span class="n">context</span>


    <span class="k">class</span> <span class="nc">ProvinceSchoolList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">School</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s">"school_reviews/school_list.html"</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'school_city'</span><span class="p">,</span> <span class="s">'school_name'</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'country_slug'</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">province</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Region</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'province_slug'</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">School</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">school_country</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">,</span>
                                         <span class="n">school_province</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">province</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ProvinceSchoolList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">context</span><span class="p">[</span><span class="s">'section'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'province'</span>
            <span class="k">return</span> <span class="n">context</span>


    <span class="k">class</span> <span class="nc">CitySchoolList</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">School</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s">"school_reviews/school_list.html"</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'school_name'</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">places</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">country</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'country_slug'</span><span class="p">])</span>
            <span class="n">province</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Region</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'province_slug'</span><span class="p">])</span>
            <span class="n">city</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">City</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'city_slug'</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">country</span><span class="p">,</span> <span class="n">province</span><span class="p">,</span> <span class="n">city</span>

        <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'country_slug'</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">province</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Region</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'province_slug'</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">City</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'city_slug'</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">School</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">school_country</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">country</span><span class="p">,</span>
                                         <span class="n">school_province</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">province</span><span class="p">,</span>
                                         <span class="n">school_city</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">city</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CitySchoolList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">context</span><span class="p">[</span><span class="s">'section'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'city'</span>
            <span class="n">context</span><span class="p">[</span><span class="s">'country'</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'country_slug'</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">context</span>
</pre>


<h3>Smart Selects</h3>
<p>The last thing we need to do is write our models incorporating the <code>ChainedForeignKey</code> that <code>django-smart-selects</code> provides. Keep in mind that the <code>chained_field</code> is the name in <em>your</em> model, while the <code>chained_model_field</code> is the name in your <em>database</em>. My names aren't the same since I used <code>django-cities-light</code> to populate the db.</p>
<pre class="code literal-block"><span class="c"># models.py</span>
<span class="k">class</span> <span class="nc">School</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">school_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">school_country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Country</span><span class="p">)</span>
    <span class="n">school_province</span> <span class="o">=</span> <span class="n">ChainedForeignKey</span><span class="p">(</span>
        <span class="n">Region</span><span class="p">,</span>
        <span class="n">chained_field</span><span class="o">=</span><span class="s">"school_country"</span><span class="p">,</span>
        <span class="n">chained_model_field</span><span class="o">=</span><span class="s">"country"</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s">"The school's province."</span>
    <span class="p">)</span>
    <span class="n">school_city</span> <span class="o">=</span> <span class="n">ChainedForeignKey</span><span class="p">(</span>
        <span class="n">City</span><span class="p">,</span>
        <span class="n">chained_field</span><span class="o">=</span><span class="s">'school_province'</span><span class="p">,</span>
        <span class="n">chained_model_field</span><span class="o">=</span><span class="s">'region'</span><span class="p">,</span>
        <span class="n">show_all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s">"The school's city."</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">school_name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">School</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">school_name</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'school_country'</span><span class="p">,</span> <span class="s">'school_province'</span><span class="p">,</span> <span class="s">'school_city'</span><span class="p">,</span> <span class="s">'school_name'</span><span class="p">)</span>
</pre>


<p>And there you have it. A Django model that relies upon chained selections of geographic data that have been auto-populated to your database.</p>
</div>
    </div>
    </article>
</div>







        </div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:luke.petschauer@me.com">Luke Petschauer</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/jquery.min.js"></script><script src="assets/js/bootstrap.min.js"></script><script src="assets/js/moment-with-locales.min.js"></script><script src="assets/js/fancydates.js"></script><script src="assets/js/jquery.colorbox-min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');  ga('create', 'UA-91925-1', 'auto');  ga('send', 'pageview');</script>
</body>
</html>
